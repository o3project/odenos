#Logging to Cassandra

Since the amount of log generated by ODENOS is very large, this app proposes
to use an alternative log4j appender, "cassandra-log4j-appender", to send log
(time-series data) from ODENOS to Cassandra.

Other applications such as the ODENOS monitor app will use Cassandra to
obtain necessary info for analytics or for drawing a message sequence diagram.

##Installation

###Step 1: Install Cassandra

Refere to [Cassandra wiki](https://wiki.apache.org/cassandra/GettingStarted).
Concretely, [DebianPackaging](https://wiki.apache.org/cassandra/DebianPackaging).

###Step 2: Install cassandra-log4j-appender

Datastax provides a log4j appender for Cassandra under Apache 2.0 license.

Follow the following steps to install it: (for log4j)
```
$ git clone https://github.com/datastax/cassandra-log4j-appender.git
$ cd cassandra-log4j-appender
$ mvn install
```

Follow the following steps to install it: (for log4j2)
```
$ cd apps/cassandra
$ mvn -Dmaven.test.skip install
```

###Step 3: Uncomment cassandra-related logger setting for ODENOS

Uncomment the following depedency element in the ODENOS's pom.xml:
```
  <dependencies>
        :
    <!--
    <dependency>
      <groupId>com.datastax.logging</groupId>
      <artifactId>cassandra-log4j-appender</artifactId>
      <version>3.1.0</version>
    </dependency>
    -->
  </dependencies> 
```

Then build ODENOS:
```
$ mvn package
```

You need to also uncomment the following lines in etc/log_java.conf: (for log4j)
```
log4j.appender.CASS=com.datastax.logging.appender.CassandraAppender
log4j.appender.CASS.hosts = 127.0.0.1
log4j.rootLogger=info, file, stdout, CASS
```

You need to uncomment the following entries in etc/log4j2_java.yaml: (for log4j2)

  - CassandraAppender:
  - ref: CassandraAppender

###Step 4: Start ODENOS

```
$ odenos start
```

###Step 5: Start cqlsh

"cqlsh" is located in ./bin of your Casssandra installation directoy.

Start cqlsh:
```
$ ./cqlsh
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 2.1.8 | CQL spec 3.2.0 | Native protocol v3]
Use HELP for help.
cqlsh> USE "Logging";
cqlsh:Logging> select * from log_entries;

 key                                  | app_name | app_start_time | class_name                                             | file_name          | host_ip   | host_name | level | line_number | log_timestamp | logger_name                                            | message                                     | method_name          | ndc  | thread_name     | throwable_str_rep
--------------------------------------+----------+----------------+--------------------------------------------------------+--------------------+-----------+-----------+-------+-------------+---------------+--------------------------------------------------------+---------------------------------------------+----------------------+------+-----------------+-------------------
 459954b1-0d0d-4bf6-9836-354830307adc |  default |  1437625670644 | org.o3project.odenos.core.manager.system.SystemManager | SystemManager.java | 127.0.1.1 |     arao2 |  INFO |         654 | 1437625674344 | org.o3project.odenos.core.manager.system.SystemManager | Registerd ComponentManager Object ID:romgr1 | putComponentManagers | null | Actor-thread(0) |              null

(1 rows)
cqlsh:Logging> 
```


